# ==============================================================================
# C Vulnerability Scanner - Caller Workflow Example
# ==============================================================================
# Copy this file to your repository at: .github/workflows/vuln-scan.yml
#
# This workflow calls the reusable vulnerability scanner from:
# https://github.com/hoangduy0308/c-vulnerability-detection
#
# For more information, see: docs/USAGE-IN-OTHER-REPOS.md
# ==============================================================================

name: C Vulnerability Scan

on:
  push:
    branches: [main, master]
    paths:
      - '**/*.c'
      - '**/*.h'

  pull_request:
    paths:
      - '**/*.c'
      - '**/*.h'

  # Allow manual trigger from GitHub UI
  workflow_dispatch:

jobs:
  vulnerability-scan:
    name: Scan for Vulnerabilities
    uses: hoangduy0308/c-vulnerability-detection/.github/workflows/vuln-scan-reusable.yml@main
    with:
      # ========================================================================
      # Model Configuration
      # ========================================================================
      # Use 'release' (default) to download model from GitHub Releases
      # Use 'custom' to provide your own model URLs
      model_source: 'release'

      # For custom model (uncomment if model_source: 'custom'):
      # model_url: 'https://your-server.com/path/to/model.pt'
      # vocab_url: 'https://your-server.com/path/to/vocabulary.json'

      # ========================================================================
      # Scan Configuration
      # ========================================================================
      # Path to scan (relative to repository root)
      scan_path: '.'

      # Probability threshold for reporting vulnerabilities (0.0-1.0)
      # Lower = more sensitive, Higher = fewer false positives
      prob_threshold: 0.5

      # Threshold to fail the CI check (0.0-1.0)
      # Set higher than prob_threshold to report but not fail
      fail_threshold: 0.5

      # ========================================================================
      # PR-specific: Scan only changed files
      # ========================================================================
      # Set to true to only scan files changed in the PR
      only_changed: false

      # Base branch for comparison (auto-detected if empty)
      # base_ref: 'main'

      # ========================================================================
      # Scanner Version
      # ========================================================================
      # Version/branch/tag of the scanner to use
      scanner_version: 'main'

    # Required permissions for SARIF upload
    permissions:
      contents: read
      security-events: write